var T=Object.create;var g=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var B=Object.getPrototypeOf,$=Object.prototype.hasOwnProperty;var h=e=>g(e,"__esModule",{value:!0});var M=(e,r)=>{for(var t in r)g(e,t,{get:r[t],enumerable:!0})},R=(e,r,t,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of k(r))!$.call(e,n)&&(t||n!=="default")&&g(e,n,{get:()=>r[n],enumerable:!(o=S(r,n))||o.enumerable});return e},f=(e,r)=>R(h(g(e!=null?T(B(e)):{},"default",!r&&e&&e.__esModule?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e),q=(e=>(r,t)=>e&&e.get(r)||(t=R(h({}),r,1),e&&e.set(r,t),t))(typeof WeakMap!="undefined"?new WeakMap:0);var d=(e,r,t)=>new Promise((o,n)=>{var u=i=>{try{c(t.next(i))}catch(a){n(a)}},p=i=>{try{c(t.throw(i))}catch(a){n(a)}},c=i=>i.done?o(i.value):Promise.resolve(i.value).then(u,p);c((t=t.apply(e,r)).next())});var W={};M(W,{OAuthErrorCode:()=>w,OAuthExtension:()=>E,OAuthPayloadMethods:()=>y,createURI:()=>D,getResult:()=>P});var C=f(require("expo-web-browser")),x=require("@magic-sdk/react-native");var A=f(require("crypto-js/sha256")),b=f(require("crypto-js/enc-base64")),I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",_=typeof window!="undefined"&&!!window.crypto,H=_&&!!window.crypto.subtle;function N(e){return Array.from(e).map(r=>I[r%I.length]).join("")}function v(e){let r=t=>t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"");if(e instanceof ArrayBuffer){let t=new Uint8Array(e),o=Array.from(t).map(u=>String.fromCharCode(u)).join(""),n=btoa(o);return r(n)}return r(b.default.stringify(e))}function L(e){return d(this,null,function*(){if(H){let r=new TextEncoder().encode(e);return crypto.subtle.digest("SHA-256",r).then(v)}return v((0,A.default)(e))})}function U(e){let r=new Uint8Array(e);if(_)window.crypto.getRandomValues(r);else for(let t=0;t<e;t+=1)r[t]=Math.floor(Math.random()*Math.floor(255));return N(r)}function O(){return d(this,null,function*(){let e=U(128),r=U(128),t=yield L(r);return{verifier:r,challenge:t,state:e}})}var y=(r=>(r.ParseRedirectResult="magic_oauth_parse_redirect_result",r))(y||{}),w=(s=>(s.InvalidRequest="invalid_request",s.InvalidClient="invalid_client",s.InvalidScope="invalid_scope",s.InvalidGrant="invalid_grant",s.UnauthorizedClient="unauthorized_client",s.UnsupportedResponseType="unsupported_response_type",s.UnsupportedGrantType="unsupported_grant_type",s.UnsupportedTokenType="unsupported_token_type",s.AccessDenied="access_denied",s.ServerError="server_error",s.TemporarilyUnavailable="temporarily_unavailable",s))(w||{});var E=class extends x.Extension.Internal{constructor(){super(...arguments);this.name="oauth";this.config={};this.compat={"magic-sdk":!1,"@magic-sdk/react-native":">=2.7.0"}}loginWithPopup(r){return this.utils.createPromiEvent((t,o)=>d(this,null,function*(){try{let{provider:n,query:u,redirectURI:p}=yield D.call(this,r),c=`https://auth.magic.link/v1/oauth2/${n}/start?${u}`,i=yield C.openAuthSessionAsync(c,p);if(i.type==="success"){let a=new URL(i.url).search;t(P.call(this,a.toString()))}else o(this.createError(i.type,"User has cancelled the authentication",{}))}catch(n){o(this.createError(n.message,"An error has occurred",{err:n}))}}))}},m="oauth_redirect_metadata";function D(e){return d(this,null,function*(){yield this.utils.storage.removeItem(m);let{provider:r,redirectURI:t,scope:o,loginHint:n}=e,{verifier:u,challenge:p,state:c}=yield O(),i=JSON.stringify({verifier:u,state:c});return yield this.utils.storage.setItem(m,i),{query:[`magic_api_key=${encodeURIComponent(this.sdk.apiKey)}`,`magic_challenge=${encodeURIComponent(p)}`,`state=${encodeURIComponent(c)}`,`platform=${encodeURIComponent("rn")}`,o&&`scope=${encodeURIComponent(o.join(" "))}`,t&&`redirect_uri=${encodeURIComponent(t)}`,n&&`login_hint=${encodeURIComponent(n)}`].reduce((l,s)=>s?`${l}&${s}`:l),provider:r,redirectURI:t}})}function P(e){return this.utils.createPromiEvent((r,t)=>d(this,null,function*(){var l;let o=yield this.utils.storage.getItem(m),{verifier:n,state:u}=JSON.parse(o);this.utils.storage.removeItem(m);let p=this.utils.createJsonRpcRequestPayload("magic_oauth_parse_redirect_result",[e,n,u]),c=yield this.request(p),i=c,a=c;a.error&&t(this.createError(a.error,(l=a.error_description)!=null?l:"An error occurred.",{errorURI:a.error_uri,provider:a.provider})),r(i)}))}module.exports=q(W);0&&(module.exports={OAuthErrorCode,OAuthExtension,OAuthPayloadMethods,createURI,getResult});
//# sourceMappingURL=index.js.map
